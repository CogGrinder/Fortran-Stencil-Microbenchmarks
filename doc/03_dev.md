# Developer info
## Technical report
Do not modify generated files.

``make`` target binary names contain all information about compilation parameters. The
refore, if modifying generated scripts by hand, one must change the makefile call by changing the target.
This has reliability purposes. Encoding the compilation parameters twice has the advantage of detecting a modification or discrepancy in the scripts or in the makefile.

### Parameters passing
Environment variables are used for everything fixed at compilation.

The parameters that are not fixed at compilation are :
- array sizes when benchmarking without size fixed at compilation (``SIZE_AT_COMPILATION`` set to 0)
- number of iterations

All parameters are set in JSON file [``all_benchmark_parameters.json`](../bench/preprocess/all_benchmark_parameters.json) generated by codegen script and can be processed by importing the JSON as a dictionary in python. See postprocess code for reference.

TODO : add a further check to assert that the target in the makefile made from the parameters corresponds to the code-generated target.

## Checklist for adding new parameters to benchmark
### Source and compilation update
- if compilation parameter
    - add preprocessor option in targets if at compilation
    - add default value in both [``Makefile``](../bench/Makefile) and [``src/Makefile``](../bench/src/Makefile)
- if execution time parameter
    - add parsing in main function of [``main.F90``](../bench/main.F90)
    - TODO: explain this better: add in generated scripts as execution parameter
### Preprocessing update
- update the ``TREE_DEPTH`` parameter in  [``codegen.py``](../bench/preprocess/codegen.py) and [``collect_data_csv.sh``](../bench/postprocess/collect_data_csv.sh) by adding 1 (one).
- [``codegen.py``](../bench/preprocess/codegen.py):
    - ``codegen_bench_tree_branch``:
        - add parameter to signature, setting a default value
        - add a layer of folder creation
            - translate the new parameter's values to a suffix using a global dictionary or string manipulation
            - add this suffix to the ``directory`` string and create a corresponding directory on the chosen depth, as was done for other parameters
        - add new export line in fstring
    - [interface] update the passing of the new parameter by creating an argparse entry and passing the parameter to the newly created parameter of ``codegen_bench_tree_branch`` in [``codegen.py``](../bench/preprocessing/codegen.py) in all execution modes.
        - make an array of all values you want to iterate over in the generator of all benchmarks and modify it using the argparse entry.
### Postprocessing update
- increment tree depth in collect_data_csv.sh
- same as run_bench_tree.sh
TODO

## Checklist for adding new stencil to benchmark
### ``src/`` update
#### add a new preprocessing option
add an entry in 
#### implement kernel
make a new ``.h`` file in [``bench/src/kernels/``](../bench/src/kernels/):
update [``select_kernel_2D.h``](../bench/src/kernels/select_kernel_2D.h) or 3D selector respectively.